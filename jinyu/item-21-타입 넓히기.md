# 타입 넓히기

타입스크립트는 상수를 사용해서 변수를 초기화할 때 타입을 명시하지 않으면 타입 체커는 타입을 결정해야 한다. 즉, 지정된 단일 값을 가지고 할당 가능한 값들의 집합을 유추해야 한다는 뜻이다. 타입스크립트에서는 이러한 과정을 '넓히기(widening)'라고 부른다.

예를 들어 벡터를 다루는 함수에서 3D 벡터에 대한 팅ㅂ과 그 요소들의 값을 얻는 함수를 작성한다고 했을 때 다음과 같이 작성할 수 있다.

```ts
interface Vector3D {
  x: number;
  y: number;
  z: number;
}

function getComponent(vector: Vector3D, axis: "x" | "y" | "z") {
  return vector[axis];
}
```

`getComponent` 함수를 다음과 같이 사용한다면 런타임에 오류 없이 실행되지만 편집기에서는 오류가 표시된다.

```ts
let x = "x";
let vec = { x: 10, y: 20, z: 30 };
getComponent(vec, x);
// ~ 'string' 형식의 인수는 '"x" | "y" | "z"'
//    형식의 매개변수에 할당될 수 없습니다.
```

`getComponent` 함수는 두 번째 매개변수에 `"x" | "y" | "z"` 타입을 기대했지만 `x`의 타입은 할당 시점에 넓히기가 동작해서 `string`으로 추론되어 발생한 오류이다.

`let`으로 선언되 변수 `x`의 경우 재사용이 가능하므로 ` "x" | "y" | "z"` 타입 말고도 모든 `string` 값을 사용할 수 있기 때문에 `string`으로 타입이 넓혀진다.

타입스크립트는 이러한 넓히기의 과정을 제어할 수 있도록 몇 가지 방법을 제공한다.

그 중 대표적인 방법이 `const`이다. `let` 대신 `const`로 변수를 선언하면 더 좁은 타입이 된다.

```ts
const x = "x"; // 타입이 'x'
let vec = { x: 10, y: 20, z: 30 };
getComponent(vec, x); // 정상
```

변수 `x`는 재할당될 수 없으므로 타입스크립트는 의심의 여지 없이 `'x'`타입으로 추론할 수 있다. 그러나 `const`는 만능이 아니다. 자바스크립트의 특징인 참조 값을 다루는 객체와 배열의 경우에는 여전히 문제가 있다.

타입 추론의 강도를 직접 제어하려면 타입스크립트의 기본 동작을 재정의해야 한다. 타입스크립트의 기본 동작을 재정의하는 세 가지 방법이 있다.

1. 명시적 타입 구문을 제공
   ```ts
   const v: { x: 1 | 3 | 5 } = { x: 1 };
   ```
2. 타입 체거에 추가적인 문맥을 제공 (예를 들어, 함수의 매개변수로 값을 전달)
   아이템 26에서 자세한 내용을 다룸.
3. const 단언문을 사용
   변수 선언 시 사용되는 `const`를 말하는 것이 아니다. const 단언문은 오로지 타입 공간의 기법이다. 값 뒤에 `as const`를 작성하면 타입스키릅티는 최대한 좁은 타입으로 추론한다.

   ```ts
   const v1 = {
     x: 1,
     y: 2,
   }; // 타입은 { x: number, y: number}

   const v2 = {
     x: 1 as const,
     y: 2,
   }; // 타입은 { x: 1, y: number}

   const v3 = {
     x: 1,
     y: 2,
   } as const; // 타입은 {readonly x: 1, readonly y: 2}
   ```

   또한 배열을 튜플 타입으로 추론할 때에도 `as const`를 사용할 수 있다.

   ```ts
   const a1 = [1, 2, 3]; // 타입이 number[]
   const a2 = [1, 2, 3] as const; // 타입이 readonly [1, 2, 3]
   ```

넓히기 동작을 제어하는 여러가지의 방법을 알아보았다. 넓히기로 인해 오류가 발생한다고 생각되면 명시적 타입 구문 또는 const 단언문을 추가하는 것을 고려하자.
